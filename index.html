<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>특명, 조카들을 막아라!</title>
	<style>
        @font-face {
        font-family: 'NeoDunggeunGothicPro';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/NeoDunggeunmoPro-Regular.woff2') format('woff2');
        font-weight: normal;
        font-display: swap;}

        body {
			margin: 0;
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('backgroundpixel.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
			color: #fff;
			display: flex;
            flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100vh;}

        @keyframes slideShow {
            0%, 45% { background-image: url('introimage1.png'); }
            50%, 95% { background-image: url('introimage2.jpg'); }
            100% { background-image: url('introimage1.png'); }
        }

        #intro-container {
            width: 800px;
            height: 800px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid #fff;
            position: relative;
            background-size: cover;
            background-position: center;
            animation: slideShow 10s infinite;
        }

        #intro-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }

        #intro-text {
            font-family: 'NeoDunggeunGothicPro';
            font-size: 28px;
            text-align: center;
            height: 300px;
            position: relative;
            z-index: 2;
        }

        #intro-text p {
            margin: 15px 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #start-button {
            font-family: 'NeoDunggeunGothicPro';
			font-size: 28px;
			padding: 15px 40px;
			cursor: pointer;
			background-color: #fff;
			border: 2px solid red;
			color: red;
			font-weight: bold;
            transition: 0.2s all;
            display: none;
            position: relative;
            z-index: 2;
        }

        #start-button:hover {
            background-color: white;
            color: red;
        }

		#game-container {
			position: relative;
			width: 800px;
			height: 800px;
			border: 2px solid #fff;
			overflow: hidden;
            background-color: #000; 
            transition: background-color 0.1s;
        }

		#player {
			position: absolute;
			width: 200px;
			height: 100px;
			bottom: 200px;
        }
        
        #warning-line {
            position: absolute;
            bottom: 155px;
            left: 0;
            right: 0;
            text-align: center;
            color: red;
            font-family: 'NeoDunggeunGothicPro';
            font-size: 24px;
            z-index: 5;
            text-shadow: 1px 1px 2px #000;/
        }

		.enemy {
			position: absolute;
			width: 150px;
			height: 150px;
            top: 0;
		}

        #protected-items {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: space-evenly;
            align-items: flex-end;
        }

        .item {
            height: 150px;
            width: auto;
            margin-bottom: 10px;}


		#ui {
            font-family: 'neoDunggeunGothicPro';
			position: absolute;
			top: 10px;
			left: 10px;
			right: 10px;
			display: flex;
			justify-content: space-between;
			font-size: 24px;
			z-index: 10;
        }
		
        #game-over {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.85);
            font-size: 60px;
            color: red;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
			text-align: center;
        }
        
        #score-form { margin-top: 10px; }

        #player-name {
            font-family: 'NeoDunggeunGothicPro';
            font-size: 20px;
            padding: 8px;
            width: 150px;
            text-align: center;
            border: 2px solid #fff;
            background: #000;
            color: #fff;
        }

        #save-button {
            font-family: 'NeoDunggeunGothicPro';
            font-size: 20px;
            padding: 8px 15px;
            cursor: pointer;
            border: 2px solid #0f0;
            background: #fff;
            color: #0f0;
        }

        #leaderboard-container {
            margin-top: 15px;
            font-size: 18px;
            color: #fff;
        }

        #leaderboard-list {
            list-style-type: decimal;
            padding-left: 40px;
            text-align: left;
            width: 250px;
        }

        #leaderboard-list li {
            padding: 2px 0;
        }

		#retry-button {
            font-family: 'NeoDunggeunGothicPro';
			font-size: 24px;
			padding: 10px 30px;
			margin-top: 20px;
			cursor: pointer;
			background-color: #fff;
			border: 2px solid red;
			color: red;
			font-weight: bold;
            transition: 0.2s all;
        }

        #retry-button:hover {
            background-color: red;
            color: #fff;
        }

        #share-container {
            margin-top: 15px;
            display: none;
            gap: 10px;                
        }

        .share-btn {
            font-family: 'NeoDunggeunGothicPro';
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 5px;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .share-btn:hover {opacity: 0.8;}

        #twitter-share { background-color: #1DA1F2; }

        #copy-link { background-color: #7f8c8d; }

        #controls-info {
            font-family: 'neoDunggeunGothicPro';
            margin-top: 15px;
            font-size: 18px;
            color: #aaa;
        }

        #controls-info strong { color: #fff; }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: fall 3s ease-out forwards;
            z-index: 15;
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotateZ(0deg); opacity: 1; }
            100% { transform: translateY(900px) rotateZ(720deg); opacity: 0; }
        }

        .cheer-bubble {
            position: absolute;
            font-family: 'NeoDunggeunGothicPro';
            background-color: rgba(255, 255, 255, 0.95);
            color: #333;
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 20px;
            z-index: 4;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .cheer-bubble.from-left {
            animation: slideFromLeft 4s ease-in-out forwards;
        }

        .cheer-bubble.from-right {
            animation: slideFromRight 4s ease-in-out forwards;
        }

        @keyframes slideFromLeft {
            0%   { left: -150px; opacity: 0; }
            20%  { left: 20px; opacity: 1; }
            80%  { left: 20px; opacity: 1; }
            100% { left: -150px; opacity: 0; }
        }

        @keyframes slideFromRight {
            0%   { right: -150px; opacity: 0; }
            20%  { right: 20px; opacity: 1; }
            80%  { right: 20px; opacity: 1; }
            100% { right: -150px; opacity: 0; }
        }

	</style>
</head>
<body>

    <div id="intro-container">
        <div id="intro-text"></div>
        <button id="start-button">GAME START</button>
    </div>
    
    <div id="game-container" style="display: none;">
        <div id="ui">
			<span>
				SCORE: <span id="score">0</span>
				<span style="margin-left: 20px;">LIVES: <span id="lives">3</span></span>
			</span>
			<span>TIME: <span id="timer">60</span></span>
        </div>

        <img src="phone.png" id="player">
        
        <div id="warning-line">========조카들이 여길 넘어가면 안돼!========</div>
        <div id="protected-items">
            <img src="computer.png" alt="컴퓨터" class="item">
            <img src="figure.png" alt="피규어" class="item">
            <img src="console.png" alt="게임기" class="item">
            <img src="comics.png" alt="만화책" class="item">
            <img src="headphone.png" alt="헤드폰" class="item">
        </div>


        <div id="game-over" style="font-family: 'neoDunggeunGothicPro';">
            <div id="game-over-text">GAME OVER</div>
            <div id="win-text" style="display:none; font-size: 72px; color: #ff0;">YOU WIN!</div>

            <div id="final-score" style="font-size:24px; color:#fff; margin-top: 10px;"></div>
            
            <div id="score-form">
                <input type="text" id="player-name" placeholder="이름 입력" maxlength="8">
                <button id="save-button">기록 저장</button>
            </div>

            <div id="leaderboard-container">
                <h4>- LEADERBOARD -</h4>
                <ol id="leaderboard-list"></ol>
            </div>
            
			<button id="retry-button">RETRY</button>

            <div id="share-container">
                <button id="twitter-share" class="share-btn">트위터 공유</button>
                <button id="copy-link" class="share-btn">링크 복사</button>
            </div>
		</div>
    </div>

    <div id="controls-info" style="display: none;">
        <strong>조작법:</strong> 이동 ← →
    </div>

<script>
    const introContainer = document.getElementById('intro-container');
    const introText = document.getElementById('intro-text');
    const startButton = document.getElementById('start-button');
    const controlsInfo = document.getElementById('controls-info');
    const gameContainer = document.getElementById('game-container');
    const player = document.getElementById('player');
    const scoreDisplay = document.getElementById('score');
    const livesDisplay = document.getElementById('lives');
    const gameOverDisplay = document.getElementById('game-over');
    const gameOverText = document.getElementById('game-over-text');
    const winText = document.getElementById('win-text');
    const timerDisplay = document.getElementById('timer');
    const retryButton = document.getElementById('retry-button');
    const finalScoreDisplay = document.getElementById('final-score');
    const scoreForm = document.getElementById('score-form');
    const playerNameInput = document.getElementById('player-name');
    const saveButton = document.getElementById('save-button');
    const leaderboardList = document.getElementById('leaderboard-list');
    
    const shareContainer = document.getElementById('share-container');
    const twitterShareButton = document.getElementById('twitter-share');
    const copyLinkButton = document.getElementById('copy-link');
    const LEADERBOARD_KEY = 'galagaLeaderboard';


    let playerX, score, lives, isGameOver, enemies, timeLeft, gameTimer, cheerInterval; // <<< cheerInterval 변수 추가
    let isMovingLeft = false;
    let isMovingRight = false;
    let shareText = '';
    const gameURL = window.location.href;
    const playerMoveAmount = 8; 
    const synopsis = [
        "민족의 대명절 한가위..",
        "눈에 불을 켠 조카들이 당신의 방을 침공한다.",
        "재산 1호 컴퓨터, 소중한 피규어, 그리고 게임기까지..",
        "당신의 보물들을 노리는 마수의 손으로부터",
        "소중한 당신의 아가들을 사수해라!"
    ];

    const cheerTexts = [
        "힘내!", "막아!", "잘한다!", "지켜라!", 
        "컴퓨터 사수!", "피규어 지켜!", "파이팅!", 
        "조카들 컷!", "나이스!", "방어 성공!"
    ];

    function createCheerBubble() {
        if (isGameOver) return;

        const bubble = document.createElement('div');
        bubble.className = 'cheer-bubble';
        
        const text = cheerTexts[Math.floor(Math.random() * cheerTexts.length)];
        bubble.innerText = text;
        
        const topPosition = Math.random() * 400 + 50; 
        bubble.style.top = topPosition + 'px';

        const fromLeft = Math.random() > 0.5;
        if (fromLeft) {
            bubble.classList.add('from-left');
        } else {
            bubble.classList.add('from-right');
        }
        
        bubble.addEventListener('animationend', () => {
            bubble.remove();
        });
        
        gameContainer.appendChild(bubble);
    }

    function showIntro() {
        let delay = 2000;
        synopsis.forEach((line, index) => {
            setTimeout(() => {
                const p = document.createElement('p');
                p.innerText = line;
                introText.appendChild(p);
                setTimeout(() => p.style.opacity = 1, 50);
            }, index * delay);
        });
        setTimeout(() => { startButton.style.display = 'block'; }, synopsis.length * delay);
    }

    function startGame() {
        introContainer.style.display = 'none';
        gameContainer.style.display = 'block';
        controlsInfo.style.display = 'block';
        initGame();
    }

	function initGame() {
        [...document.querySelectorAll('.enemy, .confetti, .cheer-bubble')].forEach(el => el.remove());
		playerX = 370; player.style.left = playerX + 'px';
		score = 0; lives = 3; isGameOver = false;
        isMovingLeft = false; isMovingRight = false; 
		enemies = [];
		scoreDisplay.innerText = score; livesDisplay.innerText = lives;
		gameOverDisplay.style.display = 'none';
        gameOverText.style.display = 'block';
        winText.style.display = 'none';
        scoreForm.style.display = 'block';
        shareContainer.style.display = 'none';
        gameContainer.style.backgroundColor = '#000'; 
		timeLeft = 60; timerDisplay.innerText = timeLeft;

		if (gameTimer) clearInterval(gameTimer);
        if (cheerInterval) clearInterval(cheerInterval);

		gameTimer = setInterval(() => {
			if (--timeLeft <= 0) { timeLeft = 0; endGame(); }
			timerDisplay.innerText = timeLeft;
		}, 1000);

        createEnemy('kakaotalk.png');
        createEnemy('kakaotalk2.png');

        cheerInterval = setInterval(createCheerBubble, 2500);

		gameLoop();
	}
	
	function endGame() {
		isGameOver = true;
		clearInterval(gameTimer);
        clearInterval(cheerInterval);

        if (lives > 0 && timeLeft <= 0) { 
            gameOverText.style.display = 'none';
            winText.style.display = 'block';
            createConfetti();
        } else {
            gameOverText.style.display = 'block';
            winText.style.display = 'none';
        }

		gameOverDisplay.style.display = 'flex';
        finalScoreDisplay.innerText = `FINAL SCORE: ${score}`;
        updateLeaderboardDisplay();
	}

    function gameLoop() {
        if (isGameOver) return;
        updatePlayer(); 
        updateEnemies();
        requestAnimationFrame(gameLoop);
    }
    
    function updatePlayer() {
        const maxPlayerX = gameContainer.clientWidth - player.width;

        if (isMovingLeft && playerX > 0) {
            playerX -= playerMoveAmount;
        } else if (isMovingRight && playerX < maxPlayerX) {
            playerX += playerMoveAmount;
        }

        if (playerX < 0) playerX = 0;
        if (playerX > maxPlayerX) playerX = maxPlayerX;

        player.style.left = playerX + 'px';
    }

    function saveScore() {
        const playerName = playerNameInput.value.trim() || 'ANONYMOUS';
        const newScore = { name: playerName, score: score };

        let scores = JSON.parse(localStorage.getItem(LEADERBOARD_KEY)) || [];
        scores.push(newScore);
        scores.sort((a, b) => b.score - a.score);
        scores.splice(10);
        localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(scores));
        
        updateLeaderboardDisplay();
        scoreForm.style.display = 'none';

        shareText = `[${playerName}]님이 '조카들을 막아라!' 게임에서 ${score}점을 획득했습니다! 🚀 #추석 #미니게임`;
        shareContainer.style.display = 'flex';
    }

    function updateLeaderboardDisplay() {
        const scores = JSON.parse(localStorage.getItem(LEADERBOARD_KEY)) || [];
        leaderboardList.innerHTML = '';
        if (scores.length === 0) {
            leaderboardList.innerHTML = '<li>아직 기록이 없습니다.</li>';
        } else {
            scores.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - ${item.score}`;
                leaderboardList.appendChild(li);
            });
        }
    }

    function copyLink() {
        navigator.clipboard.writeText(`${shareText}\n${gameURL}`).then(() => {
            alert('스코어와 게임 링크가 클립보드에 복사되었습니다!');
        });
    }

    function createConfetti() {
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = Math.random() * -100 + 'px';
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            confetti.style.animationDelay = Math.random() * 2 + 's';
            gameContainer.appendChild(confetti);
        }
    }

function createEnemy(imageSrc) {
        
        let e = document.createElement('img');
        e.src = imageSrc;
        e.className = 'enemy';
        
        const gameWidth = gameContainer.clientWidth;
        const enemySize = 50;
        
        let x = Math.random() * (gameWidth - enemySize);
        let y = Math.random() * 100;
 
        let speedX = (Math.random() - 0.5) * 4; 
        let speedY = 1 + Math.random();
        
        e.style.left = x + 'px';
        e.style.top = y + 'px';
        gameContainer.appendChild(e);
        
        enemies.push({
            element: e, 
            x: x, 
            y: y, 
            speedX: speedX,
            speedY: speedY
        });
    }

    function updateEnemies() {
        const gameWidth = gameContainer.clientWidth;
        const gameHeight = gameContainer.clientHeight;
        const enemySize = 50;
        

        const floorY = gameHeight - 100 - enemySize;
        const playerTop = player.offsetTop;

        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i];

            e.x += e.speedX;
            e.y += e.speedY;

            if (e.x <= 0) {
                e.speedX *= -1; e.x = 0;
            } else if (e.x >= gameWidth - enemySize) {
                e.speedX *= -1; e.x = gameWidth - enemySize;
            }

            if (e.y <= 0) {
                e.speedY *= -1; e.y = 0;
            }

            e.element.style.left = e.x + 'px';
            e.element.style.top = e.y + 'px';

            if (e.speedY > 0 && isColliding(e.element, player)) {
                
                e.y = playerTop - enemySize; 

                e.speedY *= -1; 
                
                let playerCenter = playerX + player.width / 2;
                let enemyCenter = e.x + enemySize / 2;
                let hitPosition = (enemyCenter - playerCenter) / (player.width / 2);
                
                e.speedX = hitPosition * 3;

                score += 10;
                scoreDisplay.innerText = score;
                
                continue;
            }

            if (e.y > floorY) {
                lives--;
                livesDisplay.innerText = lives;
                
                gameContainer.style.backgroundColor = '#500';
                setTimeout(() => gameContainer.style.backgroundColor = '#000', 100);

                if (lives <= 0) {
                    endGame();
                    break; 
                } else {
                    e.x = Math.random() * (gameWidth - enemySize);
                    e.y = 0;
                    e.speedX = (Math.random() - 0.5) * 4;
                    e.speedY = 1 + Math.random() * 2;
                }
            }
        }
    }

    function isColliding(a,b){let aRect=a.getBoundingClientRect(),bRect=b.getBoundingClientRect();return!((aRect.bottom<bRect.top)||(aRect.top>bRect.bottom)||(aRect.right<bRect.left)||(aRect.left>bRect.right));}

    document.addEventListener('keydown', function(e) {
        if (isGameOver) return;
        if (e.code === 'ArrowLeft') {
            isMovingLeft = true;
        } else if (e.code === 'ArrowRight') {
            isMovingRight = true;
        }
    });

    document.addEventListener('keyup', function(e) {
        if (e.code === 'ArrowLeft') {
            isMovingLeft = false;
        } else if (e.code === 'ArrowRight') {
            isMovingRight = false;
        }
    });

	retryButton.addEventListener('click', initGame);
    startButton.addEventListener('click', startGame);
    saveButton.addEventListener('click', saveScore);
    
    copyLinkButton.addEventListener('click', copyLink);

    showIntro();
</script>
</body>
</html>